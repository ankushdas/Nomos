type coin = p+{heads{0.5} : 1, tails{0.5} : 1}

type outcome = p+{agree{0.5} : 1, disagree{0.5} : 1}

proc asset crypto12 : ($c1 : coin), ($c2 : coin), ($c3 : coin) |{*}- ($d12 : outcome) =
{
  pcase $c1 (
    heads =>
      pcase $c2 (
        heads =>
          pcase $c3 (
            heads => $d12..agree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          | tails => $d12..agree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          )
      | tails =>
          pcase $c3 (
            heads => $d12..disagree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          | tails => $d12..disagree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          )
    )
  | tails =>
      pcase $c2 (
        heads =>
          pcase $c3 (
            heads => $d12..disagree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          | tails => $d12..disagree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          )
      | tails =>
          pcase $c3 (
            heads => $d12..agree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          | tails => $d12..agree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          )
    )
  )
}

proc asset crypto23 : ($c1 : coin), ($c2 : coin), ($c3 : coin) |{*}- ($d12 : outcome) =
{
  pcase $c1 (
    heads =>
      pcase $c2 (
        heads =>
          pcase $c3 (
            heads => $d12..agree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          | tails => $d12..agree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          )
      | tails =>
          pcase $c3 (
            heads => $d12..disagree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          | tails => $d12..disagree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          )
    )
  | tails =>
      pcase $c2 (
        heads =>
          pcase $c3 (
            heads => $d12..disagree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          | tails => $d12..disagree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          )
      | tails =>
          pcase $c3 (
            heads => $d12..agree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          | tails => $d12..agree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          )
    )
  )
}

proc asset crypto31 : ($c1 : coin), ($c2 : coin), ($c3 : coin) |{*}- ($d12 : outcome) =
{
  pcase $c1 (
    heads =>
      pcase $c2 (
        heads =>
          pcase $c3 (
            heads => $d12..agree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          | tails => $d12..agree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          )
      | tails =>
          pcase $c3 (
            heads => $d12..disagree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          | tails => $d12..disagree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          )
    )
  | tails =>
      pcase $c2 (
        heads =>
          pcase $c3 (
            heads => $d12..disagree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          | tails => $d12..disagree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          )
      | tails =>
          pcase $c3 (
            heads => $d12..agree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          | tails => $d12..agree ; wait $c1 ; wait $c2 ; wait $c3 ; close $d12
          )
    )
  )
}

