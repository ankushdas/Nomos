type channel = int ^ channel

type lossy_channel = |{*}> int ^ p&{ack{0.8} : lossy_channel,
                                    dropped{0.2} : lossy_channel}

proc asset communicator : ($d : lossy_channel) |{*}- ($c : channel) =
{
  get $d {*} ;
  m = recv $d ;
  flip {0.8} (
    HH => $d..ack ;
          work {1.} ;
          send $c m ;
          $c <- communicator <- $d
  | TT => $d..dropped ;
          $c <- communicator <- $d
  )
}