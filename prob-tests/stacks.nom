type A = 1

type stackA = p&{ ins{0.5} : <{*}| A -o stackA,
                  del{0.5} : <{*}| +{none : 1,
                                     some : A * stackAi}}

type stackAi = p&{ins{1.0} : <{*}| A -o stackAi,
                  del{0.0} : <{*}| +{none : 1,
                                     some : A * stackAi}}

proc asset empty : . |{*}- ($s : stackAi) =
{
  pcase $s (
    ins => get $s {*} ;
           $x <- recv $s ;
           $e <- empty <- ;
           work {*} ;
           $s <- elem <- $x $e
  | del => get $s {*} ;
           $s.none ;
           work {*} ;
           close $s
  )
}

proc asset elem : ($x : A), ($t : stackAi) |{*}- ($s : stackAi) =
{
  pcase $s (
    ins => get $s {*} ;
           $y <- recv $s ;
           $t..ins ;
           pay $t {*} ;
           send $t $y ;
           work {*} ;
           $s <- elem <- $x $t
  | del => get $s {*} ;
           $s.some ;
           send $s $x ;
           work {*} ;
           $s <- $t
  )
}