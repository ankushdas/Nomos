type limit = p+{A{0.4} : 1, M{0.2} : 1, N{0.4} : 1}

proc asset transition : ($IN : limit) |{*}- ($OUT : limit) =
{
  pcase $IN (
    A => flip {0.5} (
      HH => $OUT..N ;
            wait $IN ;
            close $OUT
    | TT => $OUT..M ;
            wait $IN ;
            close $OUT
    )
  | M => $OUT..A ;
         wait $IN ;
         close $OUT
  | N => flip {0.5} (
      HH => $OUT..A ;
            wait $IN ;
            close $OUT
    | TT => $OUT..N ;
            wait $IN ;
            close $OUT
    )
  )
}