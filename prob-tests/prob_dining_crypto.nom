type scoin = /\ p+{head{0.5} : \/ scoin,
                   tail{0.5} : \/ scoin}

proc transaction cryptographer : (#l : scoin), (#my : scoin) |{*}- ($c : +{agree : 1, disagree : 1}) =
{
  $ll <- acquire #l ;
  $lm <- acquire #my ;
  pcase $ll (
    head => pcase $lm (
      head => $c.agree ;
              #l <- release $ll ;
              #my <- release $lm ;
              close $c
    | tail => $c.disagree ;
              #l <- release $ll ;
              #my <- release $lm ;
              close $c
    )
  | tail => pcase $lm (
      head => $c.disagree ;
              #l <- release $ll ;
              #my <- release $lm ;
              close $c
    | tail => $c.agree ;
              #l <- release $ll ;
              #my <- release $lm ;
              close $c
    )
  )
}